#!/usr/bin/env bash

set -euxo pipefail

current_dir="$(dirname "$(readlink -f "${BASH_SOURCE[0]}")")"

source "${current_dir}/../lib/utils.sh"

function install_yay {
  local yay_url="https://aur.archlinux.org/yay.git"
  local yay_dir="/tmp/yay"
  rm -rf "${yay_dir}"
  git clone "${yay_url}" "${yay_dir}"
  bash -c "cd ${yay_dir} && makepkg -si --noconfirm"
  yay -Syu --noconfirm
}

function install_packages {
  local arch_packages_file="${current_dir}/../share/arch/packages"
  mapfile -t arch_packages < <(cat "${arch_packages_file}")
  yay -S --needed --noconfirm "${arch_packages[@]}"
}

function setup_networking {
  sudo systemctl enable NetworkManager
}

function setup_docker {
  sudo systemctl enable docker

  sudo usermod --append --groups docker "${USER}"
}

function setup_gnome {
  sudo systemctl enable gdm
}

install_yay
setup_networking
setup_docker
setup_gnome

log 'arch post-installation finished'
