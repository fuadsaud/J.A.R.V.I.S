#!/usr/bin/env bash

function xrdb_color {
  local query="$1"

  xrdb -query | grep "\*\.${query}:" | cut -f 2
}

function connected {
  nu vpn connect | grep OK
}

if [[ $1 == "status" ]]; then
  if connected; then
    bg=$(xrdb_color 'background')
    fg=$(xrdb_color 'color8')

    echo "%{F${fg}}%{B${bg}} y %{B-}%{F-}"
  else
    bg=$(xrdb_color 'background')
    fg=$(xrdb_color 'color8')

    echo "%{F${fg}}%{B${bg}} n %{B-}%{F-}"
  fi
elif [[ $1 == "toggle" ]]; then
  if connected; then
    nu vpn connect
  else
    nu vpn disconnect
  fi
fi
